<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSC Purchase Planning Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef, createElement: h } = React;
        const { createRoot } = ReactDOM;

        // Mock Data
        const mockData = {
            purchaseSchedule: [
                { week: 1, currentQty: 85000, recommendedQty: 85000 },
                { week: 2, currentQty: 60000, recommendedQty: 60000 },
                { week: 3, currentQty: 95000, recommendedQty: 95000 },
                { week: 4, currentQty: 75000, recommendedQty: 75000 },
                { week: 5, currentQty: 140000, recommendedQty: 140000 },
                { week: 6, currentQty: 70000, recommendedQty: 70000 },
                { week: 7, currentQty: 85000, recommendedQty: 85000 },
                { week: 8, currentQty: 90000, recommendedQty: 90000 },
                { week: 9, currentQty: 65000, recommendedQty: 65000 },
                { week: 10, currentQty: 80000, recommendedQty: 80000 },
                { week: 11, currentQty: 95000, recommendedQty: 95000 },
                { week: 12, currentQty: 75000, recommendedQty: 75000 }
            ],
            inventoryProjection: [
                { week: 1, p10: 110000, p50: 120000, p90: 130000 },
                { week: 2, p10: 100000, p50: 115000, p90: 125000 },
                { week: 3, p10: 130000, p50: 145000, p90: 160000 },
                { week: 4, p10: 115000, p50: 130000, p90: 145000 },
                { week: 5, p10: 135000, p50: 155000, p90: 175000 },
                { week: 6, p10: 120000, p50: 140000, p90: 160000 },
                { week: 7, p10: 135000, p50: 160000, p90: 185000 },
                { week: 8, p10: 115000, p50: 135000, p90: 155000 },
                { week: 9, p10: 125000, p50: 150000, p90: 175000 },
                { week: 10, p10: 140000, p50: 165000, p90: 190000 },
                { week: 11, p10: 160000, p50: 190000, p90: 220000 },
                { week: 12, p10: 145000, p50: 175000, p90: 205000 }
            ],
            arrivals: [
                { week: 1, totalQty: 0 },
                { week: 2, totalQty: 0 },
                { week: 3, totalQty: 85000 },
                { week: 4, totalQty: 60000 },
                { week: 5, totalQty: 95000 },
                { week: 6, totalQty: 75000 },
                { week: 7, totalQty: 140000 },
                { week: 8, totalQty: 70000 },
                { week: 9, totalQty: 85000 },
                { week: 10, totalQty: 90000 },
                { week: 11, totalQty: 65000 },
                { week: 12, totalQty: 80000 }
            ],
            consumption: [
                { week: 1, total: 65000, confirmed: 50000, expected: 15000 },
                { week: 2, total: 70000, confirmed: 55000, expected: 15000 },
                { week: 3, total: 85000, confirmed: 65000, expected: 20000 },
                { week: 4, total: 100000, confirmed: 80000, expected: 20000 },
                { week: 5, total: 115000, confirmed: 90000, expected: 25000 },
                { week: 6, total: 72000, confirmed: 58000, expected: 14000 },
                { week: 7, total: 88000, confirmed: 70000, expected: 18000 },
                { week: 8, total: 95000, confirmed: 75000, expected: 20000 },
                { week: 9, total: 68000, confirmed: 52000, expected: 16000 },
                { week: 10, total: 82000, confirmed: 65000, expected: 17000 },
                { week: 11, total: 98000, confirmed: 78000, expected: 20000 },
                { week: 12, total: 76000, confirmed: 60000, expected: 16000 }
            ]
        };

        const rollstockWidthCombinations = [
            { rollstock: 'M23', widths: [70.25, 72.5, 80.0] },
            { rollstock: 'M24', widths: [70.25, 75.0] },
            { rollstock: 'M25', widths: [80.0, 85.5] }
        ];

        // Chart Component
        function ChartComponent({ type, data, options, height = 300 }) {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (canvasRef.current) {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                    const ctx = canvasRef.current.getContext('2d');
                    chartRef.current = new Chart(ctx, {
                        type: type,
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            ...options
                        }
                    });
                }
                return () => {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                };
            }, [type, data, options]);

            return h('canvas', { ref: canvasRef, style: { height: `${height}px` } });
        }

        // Main App
        function App() {
            const [selectedRollstock, setSelectedRollstock] = useState('M23');
            const [selectedWidth, setSelectedWidth] = useState(70.25);
            const [purchaseData, setPurchaseData] = useState([...mockData.purchaseSchedule]);
            const [showDecomposed, setShowDecomposed] = useState(false);

            const availableWidths = rollstockWidthCombinations.find(r => r.rollstock === selectedRollstock)?.widths || [];

            const handleRollstockChange = (e) => {
                const newRollstock = e.target.value;
                setSelectedRollstock(newRollstock);
                const widths = rollstockWidthCombinations.find(r => r.rollstock === newRollstock)?.widths || [];
                if (widths.length > 0 && !widths.includes(selectedWidth)) {
                    setSelectedWidth(widths[0]);
                }
            };

            const handleResetToRecommended = () => {
                setPurchaseData(mockData.purchaseSchedule.map(item => ({
                    ...item,
                    currentQty: item.recommendedQty
                })));
            };

            const handleDoNothing = () => {
                setPurchaseData(purchaseData.map(item => ({
                    ...item,
                    currentQty: 0
                })));
            };

            const handleSave = () => {
                alert('Purchase schedule saved!');
            };

            const handleQuantityChange = (week, newQty) => {
                setPurchaseData(purchaseData.map(item =>
                    item.week === week ? { ...item, currentQty: Math.round(newQty / 1000) * 1000 } : item
                ));
            };

            // Chart configurations
            const purchaseChartData = {
                labels: purchaseData.map(d => `Week ${d.week}`),
                datasets: [
                    {
                        label: 'Current Purchase Plan',
                        data: purchaseData.map(d => d.currentQty),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'AI Recommendation',
                        data: purchaseData.map(d => d.recommendedQty),
                        type: 'line',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false
                    }
                ]
            };

            const inventoryChartData = {
                labels: mockData.inventoryProjection.map(d => `Week ${d.week}`),
                datasets: [
                    {
                        label: '90th Percentile',
                        data: mockData.inventoryProjection.map(d => d.p90),
                        borderColor: 'rgba(209, 213, 219, 0.5)',
                        backgroundColor: 'rgba(243, 244, 246, 0.3)',
                        fill: '+1',
                        pointRadius: 0
                    },
                    {
                        label: '50th Percentile',
                        data: mockData.inventoryProjection.map(d => d.p50),
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        pointRadius: 4,
                        fill: false
                    },
                    {
                        label: '10th Percentile',
                        data: mockData.inventoryProjection.map(d => d.p10),
                        borderColor: 'rgba(209, 213, 219, 0.5)',
                        backgroundColor: 'rgba(255, 255, 255, 0.8)',
                        fill: false,
                        pointRadius: 0
                    }
                ]
            };

            const arrivalsChartData = {
                labels: mockData.arrivals.map(d => `Week ${d.week}`),
                datasets: [
                    {
                        label: 'Incoming Shipments',
                        data: mockData.arrivals.map(d => d.totalQty),
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    }
                ]
            };

            const consumptionChartData = showDecomposed ? {
                labels: mockData.consumption.map(d => `Week ${d.week}`),
                datasets: [
                    {
                        label: 'Confirmed',
                        data: mockData.consumption.map(d => d.confirmed),
                        backgroundColor: 'rgba(30, 64, 175, 0.8)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Expected',
                        data: mockData.consumption.map(d => d.expected),
                        backgroundColor: 'rgba(147, 197, 253, 0.8)',
                        borderColor: 'rgba(147, 197, 253, 1)',
                        borderWidth: 1
                    }
                ]
            } : {
                labels: mockData.consumption.map(d => `Week ${d.week}`),
                datasets: [
                    {
                        label: 'Total Consumption',
                        data: mockData.consumption.map(d => d.total),
                        backgroundColor: 'rgba(96, 165, 250, 0.8)',
                        borderColor: 'rgba(96, 165, 250, 1)',
                        borderWidth: 1
                    }
                ]
            };

            return h('div', { className: 'min-h-screen bg-gray-50 p-8' },
                h('div', { className: 'max-w-7xl mx-auto' },
                    h('h1', { className: 'text-3xl font-bold text-gray-900 mb-8' }, 'PSC Purchase Planning'),

                    // Rollstock Selector
                    h('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
                        h('div', { className: 'flex gap-4' },
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Rollstock'),
                                h('select', {
                                    value: selectedRollstock,
                                    onChange: handleRollstockChange,
                                    className: 'border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
                                }, rollstockWidthCombinations.map(r =>
                                    h('option', { key: r.rollstock, value: r.rollstock }, r.rollstock)
                                ))
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Width'),
                                h('select', {
                                    value: selectedWidth,
                                    onChange: (e) => setSelectedWidth(parseFloat(e.target.value)),
                                    className: 'border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
                                }, availableWidths.map(w =>
                                    h('option', { key: w, value: w }, w)
                                ))
                            )
                        )
                    ),

                    // Panel 1: Purchase Recommendations
                    h('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
                        h('div', { className: 'flex justify-between items-center mb-4' },
                            h('h2', { className: 'text-xl font-semibold text-gray-900' }, 'Recommended Purchase Schedule'),
                            h('div', { className: 'flex gap-2' },
                                h('button', {
                                    onClick: handleDoNothing,
                                    className: 'px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition text-sm'
                                }, 'Do Nothing'),
                                h('button', {
                                    onClick: handleResetToRecommended,
                                    className: 'px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition text-sm'
                                }, 'Reset to Recommended'),
                                h('button', {
                                    onClick: handleSave,
                                    className: 'px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition text-sm'
                                }, 'Save')
                            )
                        ),
                        h(ChartComponent, { type: 'bar', data: purchaseChartData }),
                        h('div', { className: 'mt-4 overflow-x-auto' },
                            h('table', { className: 'min-w-full border-collapse text-sm' },
                                h('thead', null,
                                    h('tr', null,
                                        purchaseData.map(item =>
                                            h('th', {
                                                key: item.week,
                                                className: 'border border-gray-300 px-2 py-2 bg-gray-50'
                                            }, `Week ${item.week}`)
                                        )
                                    )
                                ),
                                h('tbody', null,
                                    h('tr', null,
                                        purchaseData.map(item =>
                                            h('td', {
                                                key: item.week,
                                                className: 'border border-gray-300 px-1 py-2'
                                            },
                                                h('input', {
                                                    type: 'number',
                                                    value: item.currentQty,
                                                    onChange: (e) => handleQuantityChange(item.week, parseInt(e.target.value) || 0),
                                                    step: '1000',
                                                    className: 'w-full px-2 py-1 border border-gray-300 rounded text-center text-sm'
                                                })
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Panel 2: Inventory Projection
                    h('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
                        h('h2', { className: 'text-xl font-semibold text-gray-900 mb-4' }, 'Inventory - On Hand and In Transit'),
                        h(ChartComponent, { type: 'line', data: inventoryChartData })
                    ),

                    // Panel 3: Inventory Arrivals
                    h('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
                        h('h2', { className: 'text-xl font-semibold text-gray-900 mb-4' }, 'Inventory Arrivals'),
                        h(ChartComponent, { type: 'bar', data: arrivalsChartData })
                    ),

                    // Panel 4: Consumption
                    h('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
                        h('div', { className: 'flex justify-between items-center mb-4' },
                            h('h2', { className: 'text-xl font-semibold text-gray-900' }, 'Consumption (Forecast Demand)'),
                            h('label', { className: 'flex items-center gap-2' },
                                h('input', {
                                    type: 'checkbox',
                                    checked: showDecomposed,
                                    onChange: (e) => setShowDecomposed(e.target.checked),
                                    className: 'w-4 h-4'
                                }),
                                h('span', { className: 'text-sm font-medium text-gray-700' }, 'Decompose into confirmed and expected')
                            )
                        ),
                        h(ChartComponent, {
                            type: 'bar',
                            data: consumptionChartData,
                            options: showDecomposed ? { scales: { x: { stacked: true }, y: { stacked: true } } } : {}
                        })
                    ),

                    // Tab Navigation
                    h('div', { className: 'bg-white rounded-lg shadow p-6' },
                        h('div', { className: 'flex gap-4' },
                            h('button', { className: 'px-6 py-2 bg-blue-500 text-white rounded-md font-medium' }, 'Purchase'),
                            h('button', { className: 'px-6 py-2 bg-gray-200 text-gray-700 rounded-md font-medium hover:bg-gray-300 transition' }, 'Forecast'),
                            h('button', { className: 'px-6 py-2 bg-gray-200 text-gray-700 rounded-md font-medium hover:bg-gray-300 transition' }, 'Demand Orders')
                        )
                    )
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>
